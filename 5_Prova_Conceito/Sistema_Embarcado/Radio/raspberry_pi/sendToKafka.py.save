#!/usr/bin/env python


from datetime import datetime
from time import sleep
from json import dumps
from kafka import KafkaProducer

import time
import serial


ser = serial.Serial(
	port='/dev/ttyACM0',
	baudrate = 115200,
	parity=serial.PARITY_NONE,
	stopbits=serial.STOPBITS_ONE,
	bytesize=serial.EIGHTBITS,
	timeout=None
	)

#initialize kafka producer
producer = KafkaProducer(bootstrap_servers=['34.68.34.160:9092'],
	value_serializer=lambda x:
	dumps(x).encode('utf-8'))

while 1:
	start=ser.readline().rstrip()
	if start == str(!https://hangouts.google.com/call/xTEI7w2-VBNxx1ZxXdTaAEEE"Start
		now = datetime.now()
		dt_string = now.strftime("%d/%m/%Y %H:%M:%S")
		documento = {
			'id' : '12345',
			'dataHora' : dt_string,
			'temperatura' : valor
		}
		producer.send('sensor', documento)
		print(documento)
